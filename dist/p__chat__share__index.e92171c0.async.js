"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[5881],{18429:function(e,t,n){n.d(t,{Z:function(){return u}});var r=n(87462),a=n(62435),o={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64c247.4 0 448 200.6 448 448S759.4 960 512 960 64 759.4 64 512 264.6 64 512 64zm0 76c-205.4 0-372 166.6-372 372s166.6 372 372 372 372-166.6 372-372-166.6-372-372-372zm128.01 198.83c.03 0 .05.01.09.06l45.02 45.01a.2.2 0 01.05.09.12.12 0 010 .07c0 .02-.01.04-.05.08L557.25 512l127.87 127.86a.27.27 0 01.05.06v.02a.12.12 0 010 .07c0 .03-.01.05-.05.09l-45.02 45.02a.2.2 0 01-.09.05.12.12 0 01-.07 0c-.02 0-.04-.01-.08-.05L512 557.25 384.14 685.12c-.04.04-.06.05-.08.05a.12.12 0 01-.07 0c-.03 0-.05-.01-.09-.05l-45.02-45.02a.2.2 0 01-.05-.09.12.12 0 010-.07c0-.02.01-.04.06-.08L466.75 512 338.88 384.14a.27.27 0 01-.05-.06l-.01-.02a.12.12 0 010-.07c0-.03.01-.05.05-.09l45.02-45.02a.2.2 0 01.09-.05.12.12 0 01.07 0c.02 0 .04.01.08.06L512 466.75l127.86-127.86c.04-.05.06-.06.08-.06a.12.12 0 01.07 0z"}}]},name:"close-circle",theme:"outlined"},i=n(84089),s=function(e,t){return a.createElement(i.Z,(0,r.Z)({},e,{ref:t,icon:o}))};var u=a.forwardRef(s)},15381:function(e,t,n){n.d(t,{Z:function(){return u}});var r=n(87462),a=n(62435),o={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M885.9 490.3c3.6-12 5.4-24.4 5.4-37 0-28.3-9.3-55.5-26.1-77.7 3.6-12 5.4-24.4 5.4-37 0-28.3-9.3-55.5-26.1-77.7 3.6-12 5.4-24.4 5.4-37 0-51.6-30.7-98.1-78.3-118.4a66.1 66.1 0 00-26.5-5.4H144c-17.7 0-32 14.3-32 32v364c0 17.7 14.3 32 32 32h129.3l85.8 310.8C372.9 889 418.9 924 470.9 924c29.7 0 57.4-11.8 77.9-33.4 20.5-21.5 31-49.7 29.5-79.4l-6-122.9h239.9c12.1 0 23.9-3.2 34.3-9.3 40.4-23.5 65.5-66.1 65.5-111 0-28.3-9.3-55.5-26.1-77.7zM184 456V172h81v284h-81zm627.2 160.4H496.8l9.6 198.4c.6 11.9-4.7 23.1-14.6 30.5-6.1 4.5-13.6 6.8-21.1 6.7a44.28 44.28 0 01-42.2-32.3L329 459.2V172h415.4a56.85 56.85 0 0133.6 51.8c0 9.7-2.3 18.9-6.9 27.3l-13.9 25.4 21.9 19a56.76 56.76 0 0119.6 43c0 9.7-2.3 18.9-6.9 27.3l-13.9 25.4 21.9 19a56.76 56.76 0 0119.6 43c0 9.7-2.3 18.9-6.9 27.3l-14 25.5 21.9 19a56.76 56.76 0 0119.6 43c0 19.1-11 37.5-28.8 48.4z"}}]},name:"dislike",theme:"outlined"},i=n(84089),s=function(e,t){return a.createElement(i.Z,(0,r.Z)({},e,{ref:t,icon:o}))};var u=a.forwardRef(s)},6171:function(e,t,n){n.d(t,{Z:function(){return u}});var r=n(87462),a=n(62435),o={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M724 218.3V141c0-6.7-7.7-10.4-12.9-6.3L260.3 486.8a31.86 31.86 0 000 50.3l450.8 352.1c5.3 4.1 12.9.4 12.9-6.3v-77.3c0-4.9-2.3-9.6-6.1-12.6l-360-281 360-281.1c3.8-3 6.1-7.7 6.1-12.6z"}}]},name:"left",theme:"outlined"},i=n(84089),s=function(e,t){return a.createElement(i.Z,(0,r.Z)({},e,{ref:t,icon:o}))};var u=a.forwardRef(s)},65429:function(e,t,n){n.d(t,{Z:function(){return u}});var r=n(87462),a=n(62435),o={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M885.9 533.7c16.8-22.2 26.1-49.4 26.1-77.7 0-44.9-25.1-87.4-65.5-111.1a67.67 67.67 0 00-34.3-9.3H572.4l6-122.9c1.4-29.7-9.1-57.9-29.5-79.4A106.62 106.62 0 00471 99.9c-52 0-98 35-111.8 85.1l-85.9 311H144c-17.7 0-32 14.3-32 32v364c0 17.7 14.3 32 32 32h601.3c9.2 0 18.2-1.8 26.5-5.4 47.6-20.3 78.3-66.8 78.3-118.4 0-12.6-1.8-25-5.4-37 16.8-22.2 26.1-49.4 26.1-77.7 0-12.6-1.8-25-5.4-37 16.8-22.2 26.1-49.4 26.1-77.7-.2-12.6-2-25.1-5.6-37.1zM184 852V568h81v284h-81zm636.4-353l-21.9 19 13.9 25.4a56.2 56.2 0 016.9 27.3c0 16.5-7.2 32.2-19.6 43l-21.9 19 13.9 25.4a56.2 56.2 0 016.9 27.3c0 16.5-7.2 32.2-19.6 43l-21.9 19 13.9 25.4a56.2 56.2 0 016.9 27.3c0 22.4-13.2 42.6-33.6 51.8H329V564.8l99.5-360.5a44.1 44.1 0 0142.2-32.3c7.6 0 15.1 2.2 21.1 6.7 9.9 7.4 15.2 18.6 14.6 30.5l-9.6 198.4h314.4C829 418.5 840 436.9 840 456c0 16.5-7.2 32.1-19.6 43z"}}]},name:"like",theme:"outlined"},i=n(84089),s=function(e,t){return a.createElement(i.Z,(0,r.Z)({},e,{ref:t,icon:o}))};var u=a.forwardRef(s)},30159:function(e,t,n){n.d(t,{Z:function(){return u}});var r=n(87462),a=n(62435),o={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372zm-88-532h-48c-4.4 0-8 3.6-8 8v304c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V360c0-4.4-3.6-8-8-8zm224 0h-48c-4.4 0-8 3.6-8 8v304c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V360c0-4.4-3.6-8-8-8z"}}]},name:"pause-circle",theme:"outlined"},i=n(84089),s=function(e,t){return a.createElement(i.Z,(0,r.Z)({},e,{ref:t,icon:o}))};var u=a.forwardRef(s)},90814:function(e,t,n){n.d(t,{Z:function(){return u}});var r=n(87462),a=n(62435),o={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M765.7 486.8L314.9 134.7A7.97 7.97 0 00302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 000-50.4z"}}]},name:"right",theme:"outlined"},i=n(84089),s=function(e,t){return a.createElement(i.Z,(0,r.Z)({},e,{ref:t,icon:o}))};var u=a.forwardRef(s)},63437:function(e,t,n){n.d(t,{Z:function(){return u}});var r=n(87462),a=n(62435),o={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M625.9 115c-5.9 0-11.9 1.6-17.4 5.3L254 352H90c-8.8 0-16 7.2-16 16v288c0 8.8 7.2 16 16 16h164l354.5 231.7c5.5 3.6 11.6 5.3 17.4 5.3 16.7 0 32.1-13.3 32.1-32.1V147.1c0-18.8-15.4-32.1-32.1-32.1zM586 803L293.4 611.7l-18-11.7H146V424h129.4l17.9-11.7L586 221v582zm348-327H806c-8.8 0-16 7.2-16 16v40c0 8.8 7.2 16 16 16h128c8.8 0 16-7.2 16-16v-40c0-8.8-7.2-16-16-16zm-41.9 261.8l-110.3-63.7a15.9 15.9 0 00-21.7 5.9l-19.9 34.5c-4.4 7.6-1.8 17.4 5.8 21.8L856.3 800a15.9 15.9 0 0021.7-5.9l19.9-34.5c4.4-7.6 1.7-17.4-5.8-21.8zM760 344a15.9 15.9 0 0021.7 5.9L892 286.2c7.6-4.4 10.2-14.2 5.8-21.8L878 230a15.9 15.9 0 00-21.7-5.9L746 287.8a15.99 15.99 0 00-5.8 21.8L760 344z"}}]},name:"sound",theme:"outlined"},i=n(84089),s=function(e,t){return a.createElement(i.Z,(0,r.Z)({},e,{ref:t,icon:o}))};var u=a.forwardRef(s)},98165:function(e,t,n){n.d(t,{Z:function(){return u}});var r=n(87462),a=n(62435),o={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M168 504.2c1-43.7 10-86.1 26.9-126 17.3-41 42.1-77.7 73.7-109.4S337 212.3 378 195c42.4-17.9 87.4-27 133.9-27s91.5 9.1 133.8 27A341.5 341.5 0 01755 268.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.7 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c0-6.7-7.7-10.5-12.9-6.3l-56.4 44.1C765.8 155.1 646.2 92 511.8 92 282.7 92 96.3 275.6 92 503.8a8 8 0 008 8.2h60c4.4 0 7.9-3.5 8-7.8zm756 7.8h-60c-4.4 0-7.9 3.5-8 7.8-1 43.7-10 86.1-26.9 126-17.3 41-42.1 77.8-73.7 109.4A342.45 342.45 0 01512.1 856a342.24 342.24 0 01-243.2-100.8c-9.9-9.9-19.2-20.4-27.8-31.4l60.2-47a8 8 0 00-3-14.1l-175.7-43c-5-1.2-9.9 2.6-9.9 7.7l-.7 181c0 6.7 7.7 10.5 12.9 6.3l56.4-44.1C258.2 868.9 377.8 932 512.2 932c229.2 0 415.5-183.7 419.8-411.8a8 8 0 00-8-8.2z"}}]},name:"sync",theme:"outlined"},i=n(84089),s=function(e,t){return a.createElement(i.Z,(0,r.Z)({},e,{ref:t,icon:o}))};var u=a.forwardRef(s)},3012:function(e,t,n){n.d(t,{Z:function(){return K}});var r=n(9783),a=n.n(r),o=n(19632),i=n.n(o),s=n(97857),u=n.n(s),c=n(15009),l=n.n(c),d=n(99289),f=n.n(d),p=n(5574),h=n.n(p),v=n(86968),m=n(93352),g=n(5089),y=n(51331),b=n(50888),w=n(45605),x=n(18429),C=n(22850),O=n(86250),Z=n(79531),j=n(42075),P=n(31365),k=n(15867),S=n(2487),E=n(4393),_=n(75081),L=n(93967),B=n.n(L),I=n(27361),F=n.n(I),R=n(84617),D=n(62435),A=n(3234),z={messageInputWrapper:"messageInputWrapper___nie1o",documentCard:"documentCard___JpeyA",listWrapper:"listWrapper___CSYW_",inputWrapper:"inputWrapper___xWIXi",deleteIcon:"deleteIcon___ilZaY"},M=n(86074),N=C.Z.Text,T=function(e){return F()(e,"response.data.0")},W=function(e){return e.reduce((function(e,t){return e.concat(F()(t,"response.data",[]))}),[])},q=function(e){return new Promise((function(t,n){var r=new FileReader;r.readAsDataURL(e),r.onload=function(){return t(r.result)},r.onerror=function(e){return n(e)}}))},U=function(e){var t=e.isShared,n=void 0!==t&&t,r=e.disabled,o=e.value,s=e.onPressEnter,c=e.sendDisabled,d=e.sendLoading,p=e.onInputChange,C=e.conversationId,L=e.showUploadIcon,I=void 0===L||L,U=e.createConversationBeforeUploadDocument,K=e.uploadMethod,V=void 0===K?"upload_and_parse":K,H=(0,v.qM)("chat").t,$=(0,m.an)().removeDocument,Y=(0,m.wO)().deleteDocument,Q=(0,m.hf)(),X=Q.data,J=Q.setDocumentIds,G=(0,m.tC)(V).uploadAndParseDocument,ee=(0,D.useRef)(C),te=(0,D.useState)([]),ne=h()(te,2),re=ne[0],ae=ne[1],oe=function(){var e=f()(l()().mark((function e(t){return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.url||t.preview){e.next=4;break}return e.next=3,q(t.originFileObj);case 3:t.preview=e.sent;case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ie=function(){var e=f()(l()().mark((function e(t){var n,r,a,o;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.file,r=C,!U){e.next=7;break}return e.next=5,U(n.name);case 5:0===(null==(a=e.sent)?void 0:a.code)&&(r=a.data.id);case 7:return ae((function(e){return e.push(u()(u()({},n),{},{status:"uploading",originFileObj:n})),i()(e)})),e.next=10,G({conversationId:r,fileList:[n]});case 10:o=e.sent,ae((function(e){var t=e.filter((function(e){return e.uid!==n.uid}));return t.push(u()(u()({},n),{},{originFileObj:n,response:o,percent:100,status:0===(null==o?void 0:o.code)?"done":"error"})),t}));case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),se=re.some((function(e){return"uploading"===e.status})),ue=(0,D.useCallback)(f()(l()().mark((function e(){var t;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!se){e.next=2;break}return e.abrupt("return");case 2:t=W(re.filter((function(e){return t=e,"number"==typeof(n=F()(t,"response.code"))&&0===n;var t,n}))),s(t),ae([]);case 5:case"end":return e.stop()}}),e)}))),[re,s,se]),ce=(0,D.useCallback)(function(){var e=f()(l()().mark((function e(t){var r;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=F()(t,"response.data",[]),!Array.isArray(r)||!r.length){e.next=12;break}if(!n){e.next=7;break}return e.next=5,Y(r);case 5:e.next=9;break;case 7:return e.next=9,$(r[0]);case 9:ae((function(e){return e.filter((function(e){return T(e)!==r[0]}))})),e.next=13;break;case 12:ae((function(e){return e.filter((function(e){return e.uid!==t.uid}))}));case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[$,Y,n]),le=(0,D.useCallback)((function(e){return X.find((function(t){return t.id===e}))}),[X]);return(0,D.useEffect)((function(){var e=W(re);J(e)}),[re,J]),(0,D.useEffect)((function(){ee.current&&C!==ee.current&&ae([]),ee.current=C}),[C,ae]),(0,M.jsxs)(O.Z,{gap:20,vertical:!0,className:z.messageInputWrapper,children:[(0,M.jsx)(Z.Z,{size:"large",placeholder:H("sendPlaceholder"),value:o,disabled:r,className:B()(a()({},z.inputWrapper,0===re.length)),suffix:(0,M.jsxs)(j.Z,{children:[I&&(0,M.jsx)(P.Z,{onPreview:oe,onChange:ie,multiple:!1,onRemove:ce,showUploadList:!1,beforeUpload:function(){return!1},children:(0,M.jsx)(k.ZP,{type:"text",disabled:r,icon:(0,M.jsx)(R.Z,{})})}),(0,M.jsx)(k.ZP,{type:"primary",onClick:ue,loading:d,disabled:c||se,children:H("send")})]}),onPressEnter:ue,onChange:p}),re.length>0&&(0,M.jsx)(S.Z,{grid:{gutter:16,xs:1,sm:1,md:1,lg:1,xl:2,xxl:4},dataSource:re,className:z.listWrapper,renderItem:function(e){var t,n,r,a,o,i=T(e),s=le(i),u=(0,g.RT)(null!==(t=null==s?void 0:s.name)&&void 0!==t?t:""),c=null!==(n=null===(r=e.originFileObj)||void 0===r?void 0:r.name)&&void 0!==n?n:"";return(0,M.jsx)(S.Z.Item,{children:(0,M.jsxs)(E.Z,{className:z.documentCard,children:[(0,M.jsxs)(O.Z,{gap:10,align:"center",children:["uploading"===e.status?(0,M.jsx)(_.Z,{indicator:(0,M.jsx)(b.Z,{style:{fontSize:24},spin:!0})}):"error"===e.status?(0,M.jsx)(w.Z,{size:30}):(0,M.jsx)(A.Z,{id:i,name:c}),(0,M.jsxs)(O.Z,{vertical:!0,style:{width:"90%"},children:[(0,M.jsx)(N,{ellipsis:{tooltip:c},className:z.nameText,children:(0,M.jsxs)("b",{children:[" ",c]})}),"error"===e.status?H("uploadFailed"):(0,M.jsx)(M.Fragment,{children:100!==e.percent?H("uploading"):e.response?(0,M.jsxs)(j.Z,{children:[(0,M.jsxs)("span",{children:[null==u?void 0:u.toUpperCase(),","]}),(0,M.jsx)("span",{children:(0,y.td)(null!==(a=null===(o=le(i))||void 0===o?void 0:o.size)&&void 0!==a?a:0)})]}):H("parsing")})]})]}),"uploading"!==e.status&&(0,M.jsx)("span",{className:z.deleteIcon,children:(0,M.jsx)(x.Z,{onClick:function(){return ce(e)}})})]})})}})]})},K=(0,D.memo)(U)},53827:function(e,t,n){n.d(t,{mo:function(){return D},lq:function(){return B},eL:function(){return E},bf:function(){return S},Sd:function(){return _},zw:function(){return k},XZ:function(){return R},jV:function(){return I},LI:function(){return L},OX:function(){return F}});var r=n(97857),a=n.n(r),o=n(15009),i=n.n(o),s=n(99289),u=n.n(s),c=n(40063),l=n(36235),d=n(60806),f=n(66582),p=n(78158),h={getCanvas:{url:d.Z.getCanvas,method:"get"},getCanvasSSE:{url:d.Z.getCanvasSSE,method:"get"},setCanvas:{url:d.Z.setCanvas,method:"post"},listCanvas:{url:d.Z.listCanvas,method:"get"},resetCanvas:{url:d.Z.resetCanvas,method:"post"},removeCanvas:{url:d.Z.removeCanvas,method:"post"},runCanvas:{url:d.Z.runCanvas,method:"post"},listTemplates:{url:d.Z.listTemplates,method:"get"},testDbConnect:{url:d.Z.testDbConnect,method:"post"},getInputElements:{url:d.Z.getInputElements,method:"get"},debugSingle:{url:d.Z.debug,method:"post"}},v=(0,f.Z)(h,p.ZP),m=n(71250),g=n(78551),y=n(30202),b=n(4527),w=n(45360),x=n(96486),C=n(27361),O=n.n(C),Z=n(24701),j=n(57632),P={graph:{nodes:[{id:"begin",type:"beginNode",position:{x:50,y:200},data:{label:"Begin",name:"begin"},sourcePosition:"left",targetPosition:"right"}],edges:[]},components:{begin:{obj:{component_name:"Begin",params:{}},downstream:["Answer:China"],upstream:[]}},messages:[],reference:[],history:[],path:[],answer:[]},k=function(){var e,t=(0,g.a)({queryKey:["fetchFlowTemplates"],initialData:[],queryFn:(e=u()(i()().mark((function e(){var t,n;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.listTemplates();case 2:return t=e.sent,n=t.data,Array.isArray(null==n?void 0:n.data)&&n.data.unshift({id:(0,j.Z)(),title:"Blank",description:"Create your agent from scratch",dsl:P}),e.abrupt("return",n);case 6:case"end":return e.stop()}}),e)}))),function(){return e.apply(this,arguments)})});return t.data},S=function(){var e,t=(0,g.a)({queryKey:["fetchFlowList"],initialData:[],gcTime:0,queryFn:(e=u()(i()().mark((function e(){var t,n,r;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.listCanvas();case 2:return n=e.sent,r=n.data,e.abrupt("return",null!==(t=null==r?void 0:r.data)&&void 0!==t?t:[]);case 5:case"end":return e.stop()}}),e)}))),function(){return e.apply(this,arguments)})});return{data:t.data,loading:t.isFetching}},E=function(){var e,t=(0,Z.UO)().id,n=(0,l.P7)().sharedId,r=(0,g.a)({queryKey:["flowDetail"],initialData:{},refetchOnReconnect:!1,refetchOnMount:!1,refetchOnWindowFocus:!1,gcTime:0,queryFn:(e=u()(i()().mark((function e(){var r,a,o,s;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.getCanvas({},n||t);case 2:return a=e.sent,o=a.data,s=(0,m.Bl)(O()(o,"data.dsl.messages",[])),(0,x.set)(o,"data.dsl.messages",s),e.abrupt("return",null!==(r=null==o?void 0:o.data)&&void 0!==r?r:{});case 7:case"end":return e.stop()}}),e)}))),function(){return e.apply(this,arguments)})});return{data:r.data,loading:r.isFetching,refetch:r.refetch}},_=function(){var e,t=(0,l.P7)().sharedId,n=(0,g.a)({queryKey:["flowDetailSSE"],initialData:{},refetchOnReconnect:!1,refetchOnMount:!1,refetchOnWindowFocus:!1,gcTime:0,queryFn:(e=u()(i()().mark((function e(){var n,r,a,o;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",{});case 2:return e.next=4,v.getCanvasSSE({},t);case 4:return r=e.sent,a=r.data,o=(0,m.Bl)(O()(a,"data.dsl.messages",[])),(0,x.set)(a,"data.dsl.messages",o),e.abrupt("return",null!==(n=null==a?void 0:a.data)&&void 0!==n?n:{});case 9:case"end":return e.stop()}}),e)}))),function(){return e.apply(this,arguments)})});return{data:n.data,loading:n.isFetching,refetch:n.refetch}},L=function(){var e,t=(0,y.NL)(),n=(0,b.D)({mutationKey:["setFlow"],mutationFn:(e=u()(i()().mark((function e(n){var r,a,o;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.setCanvas(n);case 2:return r=e.sent,a=r.data,0===(o=void 0===a?{}:a).code&&(w.ZP.success(c.Z.t("message.".concat(null!=n&&n.id?"modified":"created"))),t.invalidateQueries({queryKey:["fetchFlowList"]})),e.abrupt("return",o);case 7:case"end":return e.stop()}}),e)}))),function(t){return e.apply(this,arguments)})});return{data:n.data,loading:n.isPending,setFlow:n.mutateAsync}},B=function(){var e,t=(0,y.NL)(),n=(0,b.D)({mutationKey:["deleteFlow"],mutationFn:(e=u()(i()().mark((function e(n){var r,a,o;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.removeCanvas({canvasIds:n});case 2:return a=e.sent,0===(o=a.data).code&&t.invalidateQueries({queryKey:["fetchFlowList"]}),e.abrupt("return",null!==(r=null==o?void 0:o.data)&&void 0!==r?r:[]);case 6:case"end":return e.stop()}}),e)}))),function(t){return e.apply(this,arguments)})});return{data:n.data,loading:n.isPending,deleteFlow:n.mutateAsync}},I=function(){var e,t=(0,Z.UO)().id,n=(0,b.D)({mutationKey:["resetFlow"],mutationFn:(e=u()(i()().mark((function e(){var n,r;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.resetCanvas({id:t});case 2:return n=e.sent,r=n.data,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)}))),function(){return e.apply(this,arguments)})});return{data:n.data,loading:n.isPending,resetFlow:n.mutateAsync}},F=function(){var e,t=(0,b.D)({mutationKey:["testDbConnect"],mutationFn:(e=u()(i()().mark((function e(t){var n,r,a,o;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.testDbConnect(t);case 2:return 0===(null==(r=e.sent)||null===(n=r.data)||void 0===n?void 0:n.code)?w.ZP.success(null==r||null===(a=r.data)||void 0===a?void 0:a.data):w.ZP.error(null==r||null===(o=r.data)||void 0===o?void 0:o.data),e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)}))),function(t){return e.apply(this,arguments)})});return{data:t.data,loading:t.isPending,testDbConnect:t.mutateAsync}},R=function(e){var t,n=(0,Z.UO)().id,r=(0,g.a)({queryKey:["fetchInputElements",n,e],initialData:[],enabled:!!n&&!!e,retryOnMount:!1,refetchOnWindowFocus:!1,refetchOnReconnect:!1,gcTime:0,queryFn:(t=u()(i()().mark((function t(){var r,a,o;return i()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,v.getInputElements({id:n,component_id:e});case 3:return a=t.sent,o=a.data,t.abrupt("return",null!==(r=null==o?void 0:o.data)&&void 0!==r?r:[]);case 8:t.prev=8,t.t0=t.catch(0),console.log("ðŸš€ ~ queryFn: ~ error:",t.t0);case 11:case"end":return t.stop()}}),t,null,[[0,8]])}))),function(){return t.apply(this,arguments)})});return{data:r.data,loading:r.isPending}},D=function(){var e,t=(0,Z.UO)().id,n=(0,b.D)({mutationKey:["debugSingle"],mutationFn:(e=u()(i()().mark((function e(n){var r,o,s,u;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.debugSingle(a()({id:t},n));case 2:return 0!==(null==(s=e.sent)||null===(r=s.data)||void 0===r?void 0:r.code)&&w.ZP.error(null==s||null===(u=s.data)||void 0===u?void 0:u.message),e.abrupt("return",null==s||null===(o=s.data)||void 0===o?void 0:o.data);case 5:case"end":return e.stop()}}),e)}))),function(t){return e.apply(this,arguments)})});return{data:n.data,loading:n.isPending,debugSingle:n.mutateAsync}}},49955:function(e,t,n){n.r(t),n.d(t,{default:function(){return O}});var r=n(3012),a=n(26975),o=n(71580),i=n(1079),s=n(41923),u=n(86250),c=n(75081),l=n(62435),d=n(36235),f=n(35293),p=n(61110),h=n(91028),v=n(53827),m=n(71250),g="chatWrapper___V2STu",y="chatContainer___JkSeI",b="messageContainer___v6SB0",w=n(86074),x=function(){var e=(0,d.P7)(),t=e.sharedId,n=e.from,g=(0,o.B)(),x=g.visible,C=g.hideModal,O=g.documentId,Z=g.selectedChunk,j=g.clickDocumentButton,P=(0,d.I8)(),k=P.handlePressEnter,S=P.handleInputChange,E=P.value,_=P.sendLoading,L=P.loading,B=P.ref,I=P.derivedMessages,F=P.hasError,R=(0,s.q3)(E),D=(0,l.useMemo)((function(){return n===i.qH.Agent?v.Sd:h.y8}),[n])().data;return t?(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)(u.Z,{flex:1,className:y,vertical:!0,children:[(0,w.jsxs)(u.Z,{flex:1,vertical:!0,className:b,children:[(0,w.jsx)("div",{children:(0,w.jsx)(c.Z,{spinning:L,children:null==I?void 0:I.map((function(e,t){return(0,w.jsx)(a.Z,{avatardialog:null==D?void 0:D.avatar,item:e,nickname:"You",reference:(0,f.oI)({message:I,reference:[]},e),loading:e.role===i.Cs.Assistant&&_&&(null==I?void 0:I.length)-1===t,index:t,clickDocumentButton:j,showLikeButton:!1,showLoudspeaker:!1},(0,m.mN)(e))}))})}),(0,w.jsx)("div",{ref:B})]}),(0,w.jsx)(r.Z,{isShared:!0,value:E,disabled:F,sendDisabled:R,conversationId:t,onInputChange:S,onPressEnter:k,sendLoading:_,uploadMethod:"external_upload_and_parse",showUploadIcon:!1})]}),x&&(0,w.jsx)(p.Z,{visible:x,hideModal:C,documentId:O,chunk:Z})]}):(0,w.jsx)("div",{children:"empty"})},C=(0,l.forwardRef)(x),O=function(){return(0,w.jsx)("div",{className:g,children:(0,w.jsx)(C,{})})}},38780:function(e,t){t.Z=function(){const e=Object.assign({},arguments.length<=0?void 0:arguments[0]);for(let t=1;t<arguments.length;t++){const n=t<0||arguments.length<=t?void 0:arguments[t];n&&Object.keys(n).forEach((t=>{const r=n[t];void 0!==r&&(e[t]=r)}))}return e}},85576:function(e,t,n){n.d(t,{Z:function(){return x}});var r=n(56080),a=n(38657),o=n(56745),i=n(62435),s=n(93967),u=n.n(s),c=n(40974),l=n(8745),d=n(53124),f=n(32409),p=n(4941),h=n(71194),v=n(35792),m=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n};var g=(0,l.i)((e=>{const{prefixCls:t,className:n,closeIcon:r,closable:a,type:o,title:s,children:l,footer:g}=e,y=m(e,["prefixCls","className","closeIcon","closable","type","title","children","footer"]),{getPrefixCls:b}=i.useContext(d.E_),w=b(),x=t||b("modal"),C=(0,v.Z)(w),[O,Z,j]=(0,h.ZP)(x,C),P=`${x}-confirm`;let k={};return k=o?{closable:null!=a&&a,title:"",footer:"",children:i.createElement(f.O,Object.assign({},e,{prefixCls:x,confirmPrefixCls:P,rootPrefixCls:w,content:l}))}:{closable:null==a||a,title:s,footer:null!==g&&i.createElement(p.$,Object.assign({},e)),children:l},O(i.createElement(c.s,Object.assign({prefixCls:x,className:u()(Z,`${x}-pure-panel`,o&&P,o&&`${P}-${o}`,n,j,C)},y,{closeIcon:(0,p.b)(x,r),closable:a},k)))})),y=n(94423);function b(e){return(0,r.ZP)((0,r.uW)(e))}const w=o.Z;w.useModal=y.Z,w.info=function(e){return(0,r.ZP)((0,r.cw)(e))},w.success=function(e){return(0,r.ZP)((0,r.vq)(e))},w.error=function(e){return(0,r.ZP)((0,r.AQ)(e))},w.warning=b,w.warn=b,w.confirm=function(e){return(0,r.ZP)((0,r.Au)(e))},w.destroyAll=function(){for(;a.Z.length;){const e=a.Z.pop();e&&e()}},w.config=r.ai,w._InternalPanelDoNotUseOrYouWillBeFired=g;var x=w},91373:function(e,t,n){n.d(t,{Z:function(){return s}});var r=n(62435);const a=(...e)=>e.filter(((e,t,n)=>Boolean(e)&&""!==e.trim()&&n.indexOf(e)===t)).join(" ").trim();var o={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const i=(0,r.forwardRef)((({color:e="currentColor",size:t=24,strokeWidth:n=2,absoluteStrokeWidth:i,className:s="",children:u,iconNode:c,...l},d)=>(0,r.createElement)("svg",{ref:d,...o,width:t,height:t,stroke:e,strokeWidth:i?24*Number(n)/Number(t):n,className:a("lucide",s),...l},[...c.map((([e,t])=>(0,r.createElement)(e,t))),...Array.isArray(u)?u:[u]]))),s=(e,t)=>{const n=(0,r.forwardRef)((({className:n,...o},s)=>{return(0,r.createElement)(i,{ref:s,iconNode:t,className:a(`lucide-${u=e,u.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,n),...o});var u}));return n.displayName=`${e}`,n}},84617:function(e,t,n){n.d(t,{Z:function(){return r}});const r=(0,n(91373).Z)("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]])},50626:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SpeechPlayer=void 0;class n{get audio(){return this._audio}set audio(e){this._audio=e}constructor(e){this.sourceBufferCache=[],this.destroyed=!1,this.mediaSourceOpened=!1,this.options={},e&&(this.audio=e.audio||new Audio),this.options=e||{}}static async*streamAsyncIterable(e){const t=e.getReader();try{for(;;){const{done:e,value:n}=await t.read();if(e)return;yield n}}finally{t.releaseLock()}}async init(){return new Promise(((e,t)=>{this.destroyed=!1,this.mediaSource=new MediaSource,this.audio.src=URL.createObjectURL(this.mediaSource),this.initResolve=e,this.mediaSource.addEventListener("sourceopen",this.sourceOpenHandle.bind(this))}))}sourceOpenHandle(){var e,t;if(this.initResolve){this.initResolve(""),this.initResolve=null,URL.revokeObjectURL(this.audio.src),this.sourceBuffer=this.mediaSource.addSourceBuffer(null!==(t=null===(e=this.options)||void 0===e?void 0:e.mimeType)&&void 0!==t?t:"audio/mpeg");let n=0;this.audio.addEventListener("playing",(()=>{this.options.onPlaying&&this.options.onPlaying()})),this.audio.addEventListener("pause",(()=>{this.options.onPause&&this.options.onPause()})),this.sourceBuffer.addEventListener("updateend",(()=>{n&&clearTimeout(n),this.audio.paused&&this.audio.play(),!this.sourceBuffer.updating&&this.sourceBufferCache.length&&this.sourceBuffer.appendBuffer(this.sourceBufferCache.shift())})),this.audio.addEventListener("waiting",(()=>{n=setTimeout((()=>{this.sourceBuffer.updating||"open"!==this.mediaSource.readyState||0!==this.sourceBufferCache.length||(this.mediaSource.endOfStream(),this.options.onChunkEnd&&this.options.onChunkEnd())}),500)})),this.mediaSourceOpened=!0}}feed(e){if(this.destroyed)throw new ReferenceError("SpeechPlayer has been destroyed.");if(!this.mediaSourceOpened)throw new Error("MediaSource not opened, please do this update init resolved.");this.sourceBufferCache.push(e),!this.sourceBuffer.updating&&this.sourceBuffer.appendBuffer(this.sourceBufferCache.shift())}async feedWithResponse(e){for await(const t of n.streamAsyncIterable(e.body))this.feed(t)}play(){return new Promise(((e,t)=>{try{if(this.paused){this.audio.play();const t=()=>{e(!0),this.audio.removeEventListener("playing",t)};this.audio.addEventListener("playing",t)}else e(!1)}catch(e){t(e)}}))}pause(){return new Promise(((e,t)=>{try{if(this.playing){this.audio.pause();const t=()=>{this.audio.removeEventListener("pause",t),e(!0)};this.audio.addEventListener("pause",t),setTimeout((()=>{e(this.paused)}),0)}else e(!1)}catch(e){t(e)}}))}get paused(){return this.audio&&this.audio.paused}get playing(){return!this.paused}destroy(){this.audio&&!1===this.audio.paused&&this.audio.pause(),this.destroyed=!0,this.mediaSourceOpened=!1,this.mediaSource&&this.mediaSource.removeSourceBuffer(this.sourceBuffer),this.mediaSource&&this.mediaSource.endOfStream(),this.sourceBuffer.abort(),this.sourceBufferCache.splice(0)}}t.SpeechPlayer=n},87080:function(e,t,n){t.i=void 0;var r=n(50626);Object.defineProperty(t,"i",{enumerable:!0,get:function(){return r.SpeechPlayer}})},74300:function(e,t,n){function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.CopyToClipboard=void 0;var a=s(n(62435)),o=s(n(20640)),i=["text","onCopy","options","children"];function s(e){return e&&e.__esModule?e:{default:e}}function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach((function(t){y(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,t){return p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},p(e,t)}function h(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=g(e);if(t){var a=g(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return v(this,n)}}function v(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return m(e)}function m(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function g(e){return g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},g(e)}function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var b=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&p(e,t)}(u,e);var t,n,r,s=h(u);function u(){var e;d(this,u);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return y(m(e=s.call.apply(s,[this].concat(n))),"onClick",(function(t){var n=e.props,r=n.text,i=n.onCopy,s=n.children,u=n.options,c=a.default.Children.only(s),l=(0,o.default)(r,u);i&&i(r,l),c&&c.props&&"function"==typeof c.props.onClick&&c.props.onClick(t)})),e}return t=u,(n=[{key:"render",value:function(){var e=this.props,t=(e.text,e.onCopy,e.options,e.children),n=l(e,i),r=a.default.Children.only(t);return a.default.cloneElement(r,c(c({},n),{},{onClick:this.onClick}))}}])&&f(t.prototype,n),r&&f(t,r),Object.defineProperty(t,"prototype",{writable:!1}),u}(a.default.PureComponent);t.CopyToClipboard=b,y(b,"defaultProps",{onCopy:void 0,options:void 0})},74855:function(e,t,n){var r=n(74300).CopyToClipboard;r.CopyToClipboard=r,e.exports=r}}]);
//# sourceMappingURL=p__chat__share__index.e92171c0.async.js.map